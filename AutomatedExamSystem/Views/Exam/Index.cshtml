@model IEnumerable<AutomatedExamSystem.Models.Question>

<div class="container mt-4">
    <h2 class="text-center mb-3">Your Test — 50 Minutes</h2>
    <div id="timer" class="text-center fw-bold fs-4 text-danger mb-4">50:00</div>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-warning alert-dismissible fade show text-center" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <form id="examForm" asp-action="Submit" method="post">
        @Html.AntiForgeryToken()

        @foreach (var q in Model.Select((val, idx) => new { val, idx }))
        {
            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <p class="fw-bold">@(q.idx + 1). @q.val.QuestionText</p>
                    <div class="ms-3">
                        <div><input type="radio" name="answers[@q.val.Id]" value="A" /> @q.val.OptionA</div>
                        <div><input type="radio" name="answers[@q.val.Id]" value="B" /> @q.val.OptionB</div>
                        <div><input type="radio" name="answers[@q.val.Id]" value="C" /> @q.val.OptionC</div>
                        <div><input type="radio" name="answers[@q.val.Id]" value="D" /> @q.val.OptionD</div>
                    </div>
                </div>
            </div>
        }

        <div class="text-center mt-4">
            <button type="button" id="submitBtn" class="btn btn-success btn-lg">
                Submit
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        // Set timer to 50 minutes
        let totalSeconds = 50 * 60;
        const timerDisplay = document.getElementById('timer');

        const interval = setInterval(() => {
            let minutes = Math.floor(totalSeconds / 60);
            let seconds = totalSeconds % 60;
            timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            if (totalSeconds <= 0) {
                clearInterval(interval);
                document.getElementById('examForm').submit();
            }

            totalSeconds--;
        }, 1000);

        // Manual submit button
        document.getElementById('submitBtn').addEventListener('click', function () {
            if (confirm("Are you sure you want to submit your answers?")) {
                clearInterval(interval);
                document.getElementById('examForm').submit();
            }
        });
    </script>
}
